box: wercker/default
build:
  steps:
    - arjen/hugo-build:
        version: "0.14"
deploy:
  steps:
#   - install-packages:
#       packages: git ssh-client
#   - lukevivier/gh-pages@0.2.1:
#       token: $GIT_TOKEN
#       domain: tatamo.github.io
#       basedir: public
#       repo: tatamo/blog-public
    - install-packages:
        packages: lftp
    - script:
        name: mirror over lftp
        code: |
            echo $DEPLOY_FTP_SERVER
            mkdir -p $HOME/.lftp
            echo "set ssl:verify-certificate no" > $HOME/.lftp/rc
            lftp -u $DEPLOY_FTP_USER,$DEPLOY_FTP_PASS $DEPLOY_FTP_SERVER << EOF
            set ftp:ssl-allow off
            set net:timeout 5
            set net:max-retries 3
            set net:reconnect-interval-max 60
            cd blog
            ls
            mirror -enR public /blog
            EOF
#           lftp -u $DEPLOY_FTP_USER,$DEPLOY_FTP_PASS -e "set ftp:ssl-allow off;set net:timeout 5;set net:max-retries 3;set net:reconnect-interval-max 60;mirror -enR public /blog;quit" $DEPLOY_FTP_SERVER
